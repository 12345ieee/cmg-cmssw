\section{Definition of recoil}
\label{sec:defRecoil}

The recoil $\vec{U}$ is defined as the vector sum of all components excluding the leptons.
This can be written in terms of the MET as follows:
\begin{equation}
\vec{U}  = - MET +  \Sigma_{i} \space\vec{p_{T}} (\ell_{i}) 
\end{equation}

In W~$\rightarrow$~$\mu$~$\nu$ events, the $\Sigma_{i} \space\vec{p_{T}} (\ell_{i}) $ reduce to the muon $p_{T}$ and in the Z~$\rightarrow$~$\mu$~$\mu$
events, this is equivalent to the transverse momentum of the di-muon system.

The recoil is a two dimensional vector which we project along two axes oriented parallel
(U1) and perpendicular (U2) to the true boson $p_{T}$ direction.
This convention provides maximal separation between contributions to ~U
from the hadronic radiation accompanying boson production (along U1) with addition hadronic effects in the
event.

The recoil system is difficult to model from first principles; unlike the decay lepton, it is a complicated
quantity involving many particles, as well as effects related to accelerator and detector operation.
Developing a parameterized model based upon first-principles is difficult and time-consuming and for this reason,
we have used a data-driven, heuristic approach to modeling the recoil.
It requires no a priori understanding of the hadronic energy content of W events, and has no adjustable parameters.

$\vec{U}$ receives contributions from different sources: first the so called W recoil i.e. the particles arising from initial state QCD radiation from the partons that produce the hard scattering and a second contributions from the spectator quarks remnants and additional minimum bias events which occur in the same crossing ({\it in-time pile up}) or from a previous or next bunch crossing ({\it out-of-time pile up}) as the hard scattering. 
This second contribution is generally referred to as the underlying event / pile up contribution. 
Experimentally these two contributions cannot be distinguished and cannot be modelled independently.
The various components of this measured recoil system have different dependences on instantaneous
luminosity. For example, pileup and additional inelastic collisions scale with instantaneous luminosity, while
the contribution from the underlying event is luminosity independent. Moreover, detector effects such
as suppression of particles with low energy can introduce correlations between the detector response to the hard component 
and various soft components in the event.

In light of being succinct, we use the the term “recoil” to include both the hadronic activity that balances the $p_{T}$ of the bosons and the deposits from the underlying event and pile-up.

In a perfectly measured event the hadronic recoil $\vec{U}$  is expected to balance the momentum of the Z boson in the transverse plane.
Due to the experimental resolution on the hadronic recoil, the projections u1 and u2 are distributed around the values expected
for a perfectly measured event.

The detector response and resolution functions for the W recoil and underlying event products are determined by experiment using Z events.
The W recoil products are typically produced opposite to the direction of the vector boson $p_{T}$ and the underlying event products are produced uniformly in azimuth. Thus the response and resolution functions must be determined separately in two projections parallel and perpendicular to the $p_{T}$ of the W. Typically one finds that the resolution along the W $p_{T}$ is poorer due to the presence of jets from initial state QCD radiation. In the perpendicular projection the resolution function closely matches that expected from pure minimum bias events.

Z~$\rightarrow$~$\mu$~$\mu$ events provide an ideal control sample to study the MET resolution. 
First, Z~$\rightarrow$~$\mu$~$\mu$ events contain no intrinsic MET: any MET reconstructed is purely due to resolution effects with which the hadronic activity in the event, the hadronic recoil of the Z–boson, gets reconstructed.
Second, background contributions to Z~$\rightarrow$~$\mu$~$\mu$ event samples are very low, facilitating the data to Monte Carlo comparison and reducing systematic uncertainties.
Third, the Z boson decay channels can be fully reconstructed and the momenta of muons originating from Z decays are reconstructed with very good resolutions. This allow us to get precise candle for the $\pt^{Z})$ and $m^{Z}$.
Forth, the Z~$\rightarrow$~$\mu$~$\mu$ is the closest proxy to the W~$\rightarrow$~$\mu$~$\nu$.
The accurate simulation of Z boson decays in these two channels requires many elements similar to the simulation of leptonic W boson decays.
Z boson production has similar vector boson production kinematics to W boson and the Z decay channels also produce leptons of a comparable energy to leptonic W boson decays.
{\color{magenta}{HERE SAY ON THE MASS The boson are also comparable and make the energy of the recoil similar with similar scale (For example, with massless photon is more of a mess).}}
The direction of the boson in both cases ganantee the same axes for the recoil description (For example, the uparall and uperp can be clearly defined in both topology).

\newpage 

\section{Which MET to use}
\label{sec:METDEF}
In this section we study the optimal definition of the MET to be used for the MT and MET template for the W mass extraction.
We will show that the best definition use the MET constructed with the charged tracks compatible with the primary vertex.
This conclusion arise from three considerations: first it doesn't depend on the pile-up; second it has a good data-MC agreement out of the box; third it does have a good discriminating power for the MT jacobian peak.
{\color{magenta} {need to add somthing along this line: It's also important that the MET has low resolution so that in the W+jets events the MET is dominated by genuine MET}}
%The TKmet reduce the effect of in–time PU significantly.
%The effect of out–of–time PU has been reduced by the usage of ECAL timing information and the transition to a 50 ns HCAL read–out. 

\subsection{Met definition choice}
\begin{figure}[h!]
  \begin{center}
    \includegraphics[width=.5\textwidth]{RESULTS/MT_defMET.pdf}
    \caption{MT comparison with different definition of MET. MET is calculated as the negative vectorial sum of : all the generated particles (black), charge generated  particles (red), all reconstructed pf particles (blue) and reconstructed charged particles (green) the reconstructed charged particle within the dz<0.1 cm from the PV. This is shown for MC powheg $W^{+}$ events reconstructed with the 53X release and latest global tag.}
    \label{fig:PFMETvsTKMET}
  \end{center}
\end{figure}

In Figure~\ref{fig:PFMETvsTKMET} it is shown the MT for comparison for different missing ET inputs .
This is shown for MC powheg $W^{+}$ events reconstructed with the 53X release and latest global tag.
MET can be calculated as the negative vectorial sum of : 
\begin{description} 
\item[``genPFmet']  generated particles with $\eta<5.2$ (black), 
\item[``genTKmet''] charged generated  particles with $\eta<2.5$ (red), 
\item[``PFmet''] all reconstructed pf particles   (blue) 
\item[``TKmetAll''] all reconstructed charged particles (green).
\item[``TKmet''] reconstructed charged particles with dz compatibility (magenta).
\end{description}

The ``genPFmet'' (black) show the characteristic jacobian peak for W events.
The ``PFmet'' (blue) built with all the reconstructed particles suffers from the smearing due to the reconstruction efficiency and resolution and also due to the contamination of particles from pileUp. (The blue curve is indeed very different then the black)
The ``genTKmet'' (red) use the generated charged particles. Particles are detected in the tracker only up to $|\eta|$~$<$~2.5. Due to the hadronization the charged component correspons only to and average of 60\% of the total particles. Both those have the effect to smear the W jacobian peak. 
The ``TKmetAll'' (green) considers only the met with the reconstructed charged particles. 
In order to subtract the PU on an event by event basis each particle is required to be consistent with the PV requirig the $d_{Z}$~$<$~0.1~cm and this is shown with the ``TKmet'' (magenta). 
We can make two considerations: first the``TKmet'' (magenta) with a simple dz requirement approach the ideal situation represented by the red curve; second the MT shape with the ``TKmet'' (magenta) is not drammatically different from the MT distribution reconstructed with all the PF particles ``PFmet'' (blue), thus we expect the same discrimination power in light of the Wmass extraction.

\begin{figure}[h!]
  \begin{center}
    \includegraphics[width=.5\textwidth]{RESULTS/u2_RMS_vtx_TKPFcomp.pdf}
    \caption{The resolution of the U2 component is shown as function of number of vertices for PFMET (marker bla) and TKMET (marker bla). This is shown for MC powheg DY events reconstructed with the 53X release and latest global tag. This check is shown in the fiducial range of boson recoil (U~$<$~15) and 
 the muonPT, MET, and MT observables ($30<p_{T}(\mu)<55$, $60<M_{T}(\mu,met)<100$, $30<MET<55$.
}
    \label{fig:PFMETvsTKMETresVTX}
  \end{center}
\end{figure}

In Figure~\ref{fig:PFMETvsTKMETresVTX} it is shown the resolution of the MET along the component perpendicular to the bosonPt (U2) as function of number of vertices. We compare the ``PFmet'' and ``TKmet'' definition. The ``TKmet'' shows a flat component as function of vertex multiplicities while the ``PFmet'' shows an increase of the resolution with the number of vertices. We note that with PFmet Pile-up results in an approximate 10\% increase in the resolution per number of vertex (on absolute this is something like 0.6 GeV for each vertex)).
%This check is shown in the fiducial range~\footnote{those ranges are scaled also with ZWmassRatio~{\color{magenta}{are those scaling and restriction needed for this plot ?? }}} of boson recoil (U~$<$~15) and of muonPT, MET, and MT observables ($30<p_{T}(\mu)<55$, $60<M_{T}<100$, $30<MET<55$.

\subsection{DATA-MC agreement}

One of the important characteristics of the Wmass analysis is the need of a good DATA-MC agreement in terms of response and resolution.
This is to avoid to have any features that are difficult to simulate and which might bias the measurement such as the extra particles from the underlingn events ans pileup, detector holes.


\subsection{MET-phi asymmery}
Studies of the MET reconstruction in 2011 data found an asymmetry in azimuthal angle of the
 momentum balance of particles reconstructed by the particle–flow algorithm.
A $\phi$\–asymmetry is present in Monte Carlo simulated events also,
albeit of different magnitude and pointing in a different direction.

This $\phi$\–asymmetry is used as probe of the MC-data agreement.
In Figure~\ref{fig:Charged},~\ref{fig:Gamma},~\ref{fig:NeuH},~\ref{fig:HF} we show the $\phi$\–asymmetry separately for the
charged hadrons, photons, neutral hadrons and photon reconstructed in HF respectively.
It is shown separately for different sub detectors.
From those figures we see that the charged hadrons DATA-MC agreement is close to ideal.

\begin{figure}[h!]
  \begin{center}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_CHEndcapMinus.pdf}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_CHBarrel.pdf}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_CHEndcapPlus.pdf}
    \caption{Charged hadron, metPhi modulation}
    \label{fig:Charged}
  \end{center}
  \begin{center}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_GammaEdgeMinus.pdf}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_GammaEndcapMinus.pdf}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_GammaBarrel.pdf}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_GammaEndcapPlus.pdf}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_GammaEdgePlus.pdf}
    \caption{Gamma, metPhi modulation}
    \label{fig:Gamma}
  \end{center}
  \begin{center}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_H0EdgeMinus.pdf}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_H0EndcapMinus.pdf}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_H0Barrel.pdf}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_H0EndcapPlus.pdf}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_H0EdgePlus.pdf}
    \caption{Neutral Hadron, metPhi modulation}
    \label{fig:NeuH}
  \end{center}
  \begin{center}
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_HFMinus.pdf}                                                                                                    
    \includegraphics[width=.18\textwidth]{METPHI/H_metphi_HFPlus.pdf}                                                                                                     
%    \includegraphics[width=1.0\textwidth]{METPHI/H_metphi_HFMinus.pdf}
 %   \includegraphics[width=1.0\textwidth]{METPHI/H_metphi_HFPlus.pdf}
    \caption{HF hadron, metPhi modulation}
   \label{fig:HF}
  \end{center}
\end{figure}

\subsection{TKMet definition optimization}
{\color{magenta}{Add the study at 8TeV from Elisabetta with dz, weight, normalized chi2, pt}}

\subsection{photons studies}
{\color{magenta}{SLIDES:3,4}}
Here add the studies between tkmet; tkmet+photons; pfmet.



